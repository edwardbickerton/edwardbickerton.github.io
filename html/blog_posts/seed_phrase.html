<!doctype html>
<html>
  <head>
    <title>Edward Bickerton</title>
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <meta
      name="description"
      content="How is a mnemonic seed phrase used to derive all your bitcoin key pairs?"
    />
    <link rel="stylesheet" href="/CSS/style.css" />
    <script src="/javascript/website.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  </head>
  <body>
    <header-component></header-component>
    <h1>What's a seed phrase?</h1>
    <a
      href="https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki"
      target="_blank"
    >
      <img
        src="/images/seed_phrase/derivation.png"
        style="vertical-align: middle"
        width="60%"
      />
    </a>
    <section>
      Contents
      <ul>
        <li>Introduction</li>
        <li>Keys</li>
        <li>Mnemonic Code and Seed generation</li>
        <li>Security</li>
        <li>Derivation paths and key identifiers</li>
      </ul>
    </section>
    <section>
      <h2>Introduction</h2>
      <p>
        Also known as a mnemonic or mnemonic code, if you have ever used a
        bitcoin wallet you will likely have come across a seed phrase when
        setting up or backing up your wallet, you will have been asked to write
        down 12 or 24 random words. It is essential that you
        <strong>back this up offline</strong> (either on paper or steel) and
        <strong>keep it private</strong>, it is used to generate all of your
        bitcoin private keys and anyone who knows your seed can spend your
        bitcoin. This is a unique property of bitcoin, knowing <i>is</i> owning,
        or put more poetically
        <a
          href="https://twitter.com/nvk/status/1366380292991311878?s=20"
          target="_blank"
          >the map is the territory</a
        >.
      </p>
      <p>
        For most people, this is all you need to know. This post will go into
        more of the details behind hierarchical deterministic wallets (often
        referred to as hd wallets). For more information see
        <a
          href="https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki"
          target="_blank"
          >bip32 Hierarchical Deterministic Wallets</a
        >,
        <a
          href="https://github.com/bitcoin/bips/blob/master/bip-0039.mediawiki"
          target="_blank"
          >bip39 Mnemonic code for generating deterministic keys</a
        >
        and the book
        <a href="https://github.com/bitcoinbook/bitcoinbook" target="_blank"
          >Mastering Bitcoin</a
        >
        by Andreas M.Antonopoulos.
      </p>
    </section>
    <section>
      <h2>Keys</h2>
      <p>
        Put simply, public keys are used to receive bitcoin while private keys
        are used to send bitcoin. For more information see
        <a
          href="https://en.wikipedia.org/wiki/Elliptic_Curve_Digital_Signature_Algorithm"
          target="_blank"
          >ECDSA</a
        >.
      </p>
      <p>Legend</p>
      <ul>
        <li>
          A <span style="color: red">red arrow</span> represents a process which
          cannot be reversed other than by means of brute force
        </li>
        <li>
          Data in a <span style="color: blue">blue box</span> may give someone
          access to coins
        </li>
      </ul>
      <img src="/images/seed_phrase/keys.png" class="diagram" />
    </section>
    <section>
      <h2>Mnemonic Code and Seed generation</h2>
      <p>
        For the case of a 24 word mnemonic, 256 bits of entropy are generated by
        either your computer, a hardware wallet or
        <a href="/html/blog_posts/generating_seedphrase.html" target="_blank"
          >manually</a
        >
        (by dice or other means) i.e. a number between 1 and 2<sup>256</sup>
        &#8776; 10<sup>77</sup> is chosen at random, for reference it is
        <a
          href="https://www.universetoday.com/36302/atoms-in-the-universe/"
          target="_blank"
          >estimated</a
        >
        that there are between 10<sup>78</sup> and 10<sup>82</sup> atoms in the
        observable universe. By the processes displayed below this entropy is
        used to derive a seed which inturn derives everyone of your key pairs
        i.e. anyone with knowledge of this entropy can spend your bitcoin, for
        this reason it is very important that this entropy is generated securely
        and that it really is random - something which can be hard to prove.
      </p>
      <br />
      <img src="/images/seed_phrase/seed_generation.png" class="diagram" />
      <br />
      <p>
        The optional passphrase gives the user the ability to add an extra
        factor by requiring a passphrase in addition to the mnemonic code.
        Adding a passphrase will result in an entirely different seed, this is
        an excellent option if you do not trust your hardware's random number
        generator, however it adds complexity to your backup process.
      </p>
    </section>
    <section>
      <h2>Child key derivation</h2>
      <p>
        Any key (public or private) can be combined with the chain code to form
        a 512-bit extended key (prefix: xpub or xpriv) which can be used to
        derive "child keys". An extended public key (a public key combined with
        the chain code) can derive all child public keys
        <i>only,</i> whereas extended private keys can derive child private keys
        which can in turn be used to derive their corresponding public keys.
        This is a great security feature, a web-store can keep an extended
        public key on an online computer for receiving payments (without having
        to reuse a single bitcoin address) while the corresponding extended
        private key is kept securely offline.
      </p>
      <p>
        Each extended key has 2<sup>32</sup> (about 4 billion) child keys, which
        are derived by the process described in the diagram below. Half of these
        child keys are hardened, these keys have a security benefit which will
        be explained below but come with the inconvenience that parent extended
        public keys cannot derive their hardened child public keys, these must
        be derived using the parent extended private key to derive the child
        private key and then use elliptic curve multiplication to get the
        corresponding child public key. If the index number is between 0 and
        2<sup>31</sup>-1 the child key is normal, otherwise it is hardened. The
        derivation process for hardened keys is very similar, only the parent
        <i>private</i> key is used in place of the parent public key (see
        <span style="color: orange">orange arrow</span>).
      </p>
      <img src="/images/seed_phrase/CKD.png" class="diagram" />
      <p>
        Because elliptic curve multiplication is distributive the child public
        key (K<sub>i</sub>) derived from the non-hardened child private key
        (k<sub>i</sub>) is equal to the child public key derived from the parent
        extended public key: K<sub>i</sub> = k<sub>i</sub>*G = (I<sub>L</sub> +
        k<sub>par</sub>)*G = I<sub>L</sub>*G + k<sub>par</sub>*G =
        I<sub>L</sub>*G + K<sub>par</sub>.
      </p>
    </section>
    <section>
      <h2>Security</h2>
      <ul>
        <li>
          Given a public key, you cannot find the corresponding private key more
          efficiently than by solving the
          <a
            href="https://wstein.org/edu/2007/spring/ent/ent-html/node89.html"
            target="_blank"
            >EC discrete logarithm problem</a
          >
          (assumed to require 2<sup>128</sup> group operations).
        </li>
        <li>
          Given a child private key, chain code and index, an attacker cannot
          find the parent private key more efficiently than a 2<sup>256</sup>
          brute force of HMAC-SHA512.
        </li>
        <li>
          Given any number of child private keys, their chain codes and indexes
          you cannot determine whether they are derived from a common parent key
          more efficiently than a 2<sup>256</sup> brute force of HMAC-SHA512.
        </li>
        <li>
          Given a parent extended public key and a child public key it is not
          hard to find its index.
        </li>
        <li>
          Given a parent extended public key and a non-hardened child private
          key,
          <strong>it is not hard to find the parent private key</strong>. This
          is the reason for using hardened child keys.
        </li>
      </ul>
    </section>
    <section>
      <h2>Derivation paths and key identifiers</h2>
      <p>
        By the processes described above an endless family tree of keys can be
        derived from a human readable mnemonic code which is easy enough to
        remember. This is very useful for segregating funds for say different
        parts of a business, each department can have it's own branch of the
        tree, but because this tree has so many branches it is worth backing up
        the derivation path of the extended keys you use to derive receiving
        addresses as well as using standard derivation paths,
        <strong>failure to do so could result in loss of funds</strong>.
      </p>
      <p class="code">
        m / purpose' / coin type' / account' / change / address index
      </p>
      <p>
        (i' is used to represent the i<sup>th</sup> hardened child istead of
        i+2<sup>31</sup> for ease of notation.)
      </p>
      <img src="/images/seed_phrase/example1.png" class="screenshot" />
      <p>
        In the example above (using
        <a href="https://www.sparrowwallet.com" target="_blank"
          >Sparrow wallet</a
        >) the extended public key (xpub) is the 0<sup>th</sup> hardened child
        of the 0<sup>th</sup> hardened child of the 84<sup>th</sup> hardened
        child of the master key. This is a standard derivation defined in
        <a
          href="https://github.com/bitcoin/bips/blob/master/bip-0084.mediawiki"
          target="_blank"
          >bip84</a
        >. The master fingerprint is just the first 32-bits of the Hash160 of
        the public key and is used to quickly identify different keys.
      </p>
      <img src="/images/seed_phrase/example2.png" class="screenshot" />
      <p>
        In the example above we see a specific address and its derivation, from
        the derivation we can see that it is the 7<sup>th</sup> receiving
        address of the 0<sup>th</sup> bitcoin account on the branch intended for
        Native Segwit (P2WPKH) addresses. Note: I don't recommend using say the
        100<sup>th</sup> receive address before using any of the addresses
        before it as this will likely be greater than your wallets gap limit and
        bitcoin sent to this address may not be shown and may cause headaches
        when recovering funds.
      </p>
    </section>
    <footer-component></footer-component>
  </body>
</html>
